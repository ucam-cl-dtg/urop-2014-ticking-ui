<!DOCTYPE html>
<html lang="en" ng-app="eTick">
<html>
<head>
<title>Student Page</title>
<script src="../bower_components/platform/platform.js"></script>
<link rel="import" href="../bower_components/font-roboto/roboto.html">
<link rel="import"
	href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../elements/dialog.html">



<style>
body {
	font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
	margin: 0;
	padding: 24px;
}

h2 {
	color: #5264ae;
	padding: 0;
}

h1 {
	color: #1F2383;
}

paper-button {
	margin: 1em;
	width: 10em;
}

paper-button.colored {
	background: #009933;
	color: #fff;
}

#hidden {
	display: none;
}

</style>
</head>
<body>
	<h1>Workflow Test Page</h1>
	<!-- page code -->
	<table>
		<tr>
		<td>
			<h2>Add Repo:</h2>
			<paper-button raisedButton class="colored" label="ADD" id="add"></paper-button>
		</td><td>
			<h2>Submit Tick:</h2>
			<paper-button raisedButton class="colored" label="SUBMIT" id="submit"></paper-button>
		</td><td>
			<h2>Fork a Repo:</h2>
			<paper-button raisedButton class="colored" label="FORK" id="fork"></paper-button>
		</td>
		</tr>
	</table>

	<my-dialog id="overlay" transition="core-transition-bottom">
		<h3>Create a Repository:</h3>
		<div horizontal layout center>
			<paper-input 
				id="input" 
				floatingLabel 
				label="Repository name..." 
				validate="^([0-9a-zA-Z])([\w|\-|/|.]*)$" 
				error="Invalid repository name.">
			</paper-input>
			<paper-button class="button hidden" label="CREATE" id="create" core-overlay-toggle></paper-button>
		</div>
	</my-dialog>

	<my-dialog id="error-dialog" transition="core-transition-center">
		<h3>Error:</h3>
		<p>Could not create repository.</p>
	<my-dialog>

	<core-ajax  id="addAPI" 
				url="http://localhost:8080/UROP_UI/api/tick/new" 
				handleAs="json"
				contentType="application/json"
				method="POST"></core-ajax>


	<script>
		var fork = document.querySelector('#fork');
		var add = document.querySelector('#add');
		var input = document.querySelector('#input');
		var create = document.querySelector('#create');
		var call = document.querySelector('#addAPI');
		
		input.addEventListener('input', function() {
			if(input.invalid) {
				create.style.display = 'none';
			}
			else {
				create.style.display = 'inline-block';
			}
		});

		add.addEventListener('click', function() {
			document.querySelector('#overlay').toggle();
		});

		create.addEventListener('click', function() {
			call.params = '{"name": "' + input.value + '"}';
			call.go();
		});

		call.addEventListener('core-response', function() {
				console.log(this.response);
				console.log('Success');
		});
		call.addEventListener('core-error', function() {
			document.querySelector('#error-dialog').toggle();
		});
	</script>
</body>
</html>