<!DOCTYPE html>
<html lang="en" ng-app="eTick">
<html>
<head>
<title>Student Page</title>
<script src="../bower_components/platform/platform.js"></script>
<link rel="import" href="../bower_components/font-roboto/roboto.html">
<link rel="import"
	href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../elements/dialog.html">



<style>
body {
	font-family: RobotoDraft, 'Helvetica Neue', Helvetica, Arial;
	margin: 0;
	padding: 24px;
}

h2 {
	color: #5264ae;
	padding: 0;
}

h1 {
	color: #1F2383;
}

paper-button {
	margin: 1em;
	width: 10em;
}

paper-button.colored {
	background: #009933;
	color: #fff;
}

#hidden {
	display: none;
}

</style>
</head>
<body>
	<h1>Workflow Test Page</h1>
	<!-- page code -->
	<table>
		<tr>
		<td>
			<h2>Add Repo:</h2>
			<paper-button raisedButton class="colored" label="ADD" id="add"></paper-button>
		</td><td>
			<h2>Submit Tick:</h2>
			<paper-button raisedButton class="colored" label="SUBMIT" id="submit"></paper-button>
		</td><td>
			<h2>Fork a Repo:</h2>
			<paper-button raisedButton class="colored" label="FORK" id="fork"></paper-button>
		</td>
		</tr>
	</table>

	<!-- Add Repository -->

	<my-dialog id="addOverlay" transition="core-transition-top">
		<h3>Create a Repository:</h3>
		<div horizontal layout center>
			<paper-input 
				id="addInput" 
				floatingLabel 
				label="Repository name..." 
				validate="^([0-9a-zA-Z])([\w|\-|/|.]*)$" 
				error="Invalid repository name.">
			</paper-input>
			<paper-button class="button hidden" label="CREATE" id="create" core-overlay-toggle></paper-button>
		</div>
	</my-dialog>

	<my-dialog id="addError" transition="core-transition-center">
		<h3>Error:</h3>
		<p>Could not create repository.</p>
	<my-dialog>

	<core-ajax  id="addAPI" 
				url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/tick/new" 
				handleAs="json"
				contentType="application/json"
				method="POST"></core-ajax>

	<!-- Fork Repository -->

	<my-dialog id="forkOverlay" transition="core-transition-top">
		<h3>Fork a Repository:</h3>
		<div horizontal layout center>
			<paper-input 
				id="forkInput" 
				floatingLabel 
				label="Repository name..." 
				validate="^([0-9a-zA-Z])([\w|\-|/|.]*)$" 
				error="Invalid repository name.">
			</paper-input>
			<paper-button class="button hidden" label="FORK" id="forkify" core-overlay-toggle></paper-button>
		</div>
	</my-dialog>
	<my-dialog id="forkError" transition="core-transition-center">
		<h3>Error:</h3>
		<p>Could not fork the repository.</p>
	<my-dialog>

	

	<script>
		var fork = document.querySelector('#fork');
		var add = document.querySelector('#add');
		var addInput = document.querySelector('#addInput');
		var forkInput = document.querySelector('#forkInput');
		var create = document.querySelector('#create');
		var forkify = document.querySelector('#forkify');
		var call = document.querySelector('#addAPI');
		
		addInput.addEventListener('input', function() {
			if(addInput.invalid) {
				create.style.display = 'none';
			}
			else {
				create.style.display = 'inline-block';
			}
		});
		forkInput.addEventListener('input', function() {
			if(forkInput.invalid) {
				forkify.style.display = 'none';
			}
			else {
				forkify.style.display = 'inline-block';
			}
		});


		add.addEventListener('click', function() {
			document.querySelector('#addOverlay').toggle();
		});

		fork.addEventListener('click', function() {
			document.querySelector('#forkOverlay').toggle();
		});

		create.addEventListener('click', function() {
			call.body = '{"name": "' + addInput.value + '"}';
			call.go();
		});

		call.addEventListener('core-response', function() {
				console.log(this.response);
				console.log('Success');
		});
		call.addEventListener('core-error', function() {
			document.querySelector('#addError').toggle();
		});
	</script>
</body>
</html>