<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="person-list.html">
<link rel="import" href="dialog.html">

<polymer-element name="group-members" attributes="gid allowAdd rows">
	<template>
		<style>
			:host {
				display: block;
				width: 100%;
			}

			#personListContainer {
				width: 100%;
				height: calc(60px * {{rows}});
				overflow: auto;
			}

			h1 {
				font-size: 1.8rem;
				font-weight: 200;
				padding: 0 0 0 10px;
			}

			table {
				float: center;
			}

			td {
				color: #555555;
				padding: 0 10px 15px 10px;
				width: 25;	
				text-align: center;
			}
		</style>
		
		<!-- Add Member Ajax call. -->
		<core-ajax id="addMemberAjax"
			method="POST"
			contentType="application/json"
			url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/grouping">
		</core-ajax>

		<!-- Member list Ajax call. -->
		<core-ajax id="listAjax"
			auto
			url="{{'http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/group/' + gid + '/users'}}"
			handleAs="json"
			on-core-response="{{listResponse}}">
		</core-ajax>


		<!-- Card heading. -->
		<div id="headerBar" layout horizontal center>
			<h1 flex>Members ({{$.members.number}})</h1>
			<template if="{{allowAdd}}">
				<paper-icon-button icon="add" on-click="{{addMemberClicked}}" core-overlay-toggle></paper-icon-button>
			</template>
		</div>

		<!-- Member list. -->
		<div id="personListContainer">
			<person-list id="members" listURL="{{'http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/group/' + gid + '/users'}}"></person-list>
		</div>

		<!-- Add Member dialog. -->


	</template>
	<script>
		Polymer('group-members', {
			addMemberClicked: function () {
				// this.$.addDialog.toggle();
				this.$.addMemberAjax.body = '{"user":"arb33", "group":"' + this.gid + '", "role":"OVERVIEW"}';
				this.$.addMemberAjax.go();
				this.$.listAjax.go();
			},

			listResponse: function() {
				console.log('got list response');
				this.$.members.people = this.$.listAjax.response;
			}
		});
	</script>
</polymer-element>