<!-- Performs actions in the background on logging in. -->

<link rel="import" href="../bower_components/core-ajax/core-ajax.html">

<polymer-element name="on-login" attributes="groupItems tickItems">
	<template>
			<!-- API call: adds user if not already registered. -->
			<core-ajax id="loginAjax"
				url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/raven/login"
				handleAs="json"
				on-core-response="{{loginResponse}}">
			</core-ajax>

			<!-- API call to populate sidebar menu. -->
			<core-ajax id="sidebarAjax"
				url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/user/groups"
				handleAs="json"
				on-core-response="{{sidebarResponse}}">
			</core-ajax>
			
			<!-- API call to populate sidebar tick menu. -->
			<core-ajax id="sidebarTickAjax"
				url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/user/ticks"
				handleAs="json"
				on-core-response="{{sidebarTickResponse}}">
			</core-ajax>

			<!-- API call to logout. -->
			<core-ajax id="logoutAjax"
				method="delete"
				url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/raven/logout">
			</core-ajax>


	</template>
	<script>
		Polymer('on-login', {
			ready: function() {
				this.$.loginAjax.go();
			},
			loginResponse: function() {
				this.ldap = this.$.loginAjax.response;
				// Do somthing with this.$.loginAjax.response if needed.
				this.$.sidebarAjax.go();
			},
			sidebarResponse: function() {
				this.groupItems = this.$.sidebarAjax.response;
			}
			sidebarTickResponse: function() {
				this.tickItems = this.$.sidebarTickAjax.response;
				console.log(this.tickItems);
			}
		});
	</script>
</polymer-element>