<!-- Element representing a 'Group' page. -->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="main-card.html">
<link rel="import" href="group-members.html">
<link rel="import" href="tick-list.html">


<link rel="import" href="person-list.html">

<polymer-element name="x-group" attributes="gid name info creator">
	<template>
		<link rel="stylesheet" type="text/css" href="../css/elements/group.css" shim-shadowdom>

		<!-- User roles API call. -->
		<core-ajax id="roleAjax"
			url="{{'http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/user/' + gid + '/roles'}}"
			handleAs="json" on-core-response="{{roleResponse}}">
		</core-ajax>

		<!-- Available signup sheets API call. -->
		<core-ajax id="sheetListAPI"
			url="{{'http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/signups/groups/' + gid }}"
			handleAs="json"
			on-core-response="{{sheetListResponse}}">
		</core-ajax>

		<!-- Group info card. -->
		<main-card animated>
			<div layout vertical start>
				<div layout horizontal end style="width: 100%;">
					<h1 class="groupName">{{name}}</h1>
					<span layout horizontal end end-justified flex>
						<paper-icon-button id="groupDeleteButton" icon="delete"></paper-icon-button>
						<paper-icon-button id="groupCloneButton" icon="content-copy"></paper-icon-button>
						<paper-icon-button id="groupEditButton" icon="create"></paper-icon-button>
					</span>
				</div>
				<p class="creator">Created by: {{creator}}</p>
				<div id="infoContainer">
					<template if="{{!(info === '')}}">
					<div style="padding: 15px">
						<h2>DESCRIPTION:</h2>
						<p>{{info}}</p>
					</div>
					</template>
				</div>
			</div>
		</main-card>
		
		<!-- <div id="headerBar" layout horizontal center>
			<h1 flex>Members ({{number}})</h1>
			<template if="{{allowAdd}}">
				<paper-icon-button icon="delete" on-click="{{deleteMemberClicked}}"></paper-icon-button>
				<paper-icon-button icon="add" on-click="{{addMemberClicked}}" core-overlay-toggle></paper-icon-button>
			</template>
			<search-box id="searchBox" placeholder="Search..."></search-box>
		</div>-->

		<!-- Group members card. -->
		<main-card animated
			on-main-card-swipe-away="{{cardSwiped}}">
			<group-members gid="{{gid}}" allowAdd="{{allowAddMembers}}" rows="4"></group-members>
		</main-card>

		<!-- Tick list card. -->
		<main-card animated>
			<tick-list gid="{{gid}}"></tick-list>
		</main-card>

		<!-- Group content card. -->
		<!-- <main-card animated>
			<paper-tabs selected=0 on-core-select="{{tabSelectedAction}}">
				<template repeat="{{role in roles}}">
					<paper-tab>{{role}}</paper-tab>
				</template>
			</paper-tabs>

			<author-pane id="authorPane" gid="{{gid}}" class="hidden"></author-pane>


			<div id="markerPane" class="hidden">Marker Pane</div>
			<div id="overviewPane" class="hidden">Marker Pane</div>
			<div id="submitterPane" class="hidden">Marker Pane</div>
		</main-card> -->

	</template>
	<script>
		Polymer('x-group', {  

			domReady: function () {
				this.$.roleAjax.go();
				// this.$.sheetListAPI.go();
			},

			roleResponse: function() {
				this.roles = this.$.roleAjax.response;
				// Check for Author (add member) permissions.
				this.allowAddMembers = (this.roles.indexOf('AUTHOR') > -1);
			},

			tabSelectedAction: function(e, detail) {
				if (this.pane) {
					this.pane.classList.add('hidden');
				}
				var role = detail.item.innerHTML;
				switch(role) {
					case "AUTHOR": this.pane = this.$.authorPane; break;
					case "MARKER": this.pane = this.$.markerPane; break;
					case "OVERVIEW": this.pane = this.$.overviewPane; break;
					case "SUBMITTER": this.pane = this.$.submitterPane; break;
				}
				this.pane.classList.remove('hidden');
			},

			cardSwiped: function (e, detail) {
				// Code to get rid of the card. Consider other options.
				detail.card.style.display = "none";
			},

			sheetListResponse: function () {
				this.sheets = this.$.sheetListAPI.response;
				console.log(this.sheets);
			}
		});
	</script>
</polymer-element>