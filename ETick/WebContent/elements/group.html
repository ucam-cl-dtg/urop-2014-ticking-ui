<!-- Element representing a 'Group' page. -->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">


<link rel="import" href="person-list.html">

<polymer-element name="x-group" attributes="gid">
	<template>
		<link rel="stylesheet" type="text/css" href="../css/elements/group.css" shim-shadowdom>

		<core-ajax id="roleAjax"
			auto
			url="{{'http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/user/' + gid + '/roles'}}"
			handleAs="json" on-core-response="{{roleResponse}}">
		</core-ajax>

		<paper-tabs selected=0 on-core-select="{{tabSelectedAction}}">
			<template repeat="{{role in roles}}">
				<paper-tab>{{role}}</paper-tab>
			</template>
		</paper-tabs>

		<div id="frameContainer">
			<iframe id="frame" on-load="{{frameLoaded}}"></iframe>
		</div>

	</template>
	<script>
		Polymer('x-group', {  

			roleResponse: function() {
				this.roles = this.$.roleAjax.response;
			},

			tabSelectedAction: function(e, detail) {
				var role = detail.item.innerHTML;
				var url = "../pages/" + role + ".html";
				this.$.frame.contentWindow.location.replace(url);
			},
			resizeIFrame: function () {
		    	var frame = this.$.frame;
		    	var doc = frame.contentDocument;
		    	if (doc) {
		    		var docElt = doc.documentElement;
		    		frame.style.height = 'auto';
		    		frame.style.height = docElt.offsetHeight + 'px';
		    	}
		    },

		    frameLoaded: function() {
		    	if (this.$) {
		    		this.$.frame.contentWindow.addEventListener('polymer-ready', function() {
		    			setTimeout(this.resizeIFrame.bind(this), 100); 
		    		}.bind(this));
		    	}
		    }
		});
	</script>
</polymer-element>