<!-- vim: set shiftwidth=2 tabstop=2 softtabstop=2 expandtab textwidth=72 : -->
<link rel="import" href="../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../bower_components/paper-button/paper-button.html"/>
<link rel="import" href="../../bower_components/core-input/core-input.html"/>
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html"/>

<polymer-element name="ticker-set-result"
                 attributes="repoName crsid tickId commitId">
  <template>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="ticker-set-result-style.css"/>

    <core-ajax id="setTickResult"
               method="PUT"
               contentType="application/json">
    </core-ajax>


    <div class="top">
      <core-input id="tickerComment"
                  multiline
                  class="input"
                  rows="3"
                  placeholder="Enter comments here.">
      </core-input>
    </div>
    <div class="bottom">
      <paper-button raisedButton
                    class="colored green"
                    label="PASS"
                    on-tap="{{passTick}}">
      </paper-button>
      <paper-button raisedButton
                    class="colored red"
                    label="FAIL"
                    on-tap="{{failTick}}">
      </paper-button>
    </div>
  </template>
  <script src="../../hardcoded.js"></script>
  <script>
    Polymer('ticker-set-result'
      , {   sendTick:
            function (tickStatus, comment)
            {
              "use strict";

              if (tickStatus != "PASS")
              {
                tickStatus = "FAIL";
              }

              if (typeof comment == typeof undefined)
              {
                comment = null;
              }

              /* TODO: Test this */
              this.$.setTickResult.url =
                ticking_service + "/fork/" + this.tickId;

              this.$.setTickResult.params =
                  '{   "humanPass"      : tickStatus'
                + '  , "signedUp"       : false'
                + '  , "tickerComments" : comment'
                + '  , "commitId"       : this.commitId'
                + '}'

              this.$.setTickResult.go();
            }

          , passTick: function ()
            {
              this.sendTick("PASS", undefined);
            }

          , failTick: function ()
            {
              this.sendTick("FAIL", this.$.tickerComment);
            }
        });
  </script>
</polymer-element>
