<!-- vim: set shiftwidth=2 tabstop=2 softtabstop=2 expandtab textwidth=72 : -->
<link rel="import" href="../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../bower_components/paper-button/paper-button.html"/>
<link rel="import" href="../../bower_components/core-input/core-input.html"/>
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html"/>

<polymer-element name="ticker-set-result"
                 attributes="repoName crsid tickId commitId">
  <template>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="ticker-set-result-style.css"/>

    <core-ajax id="setTickResult"
               method="PUT"
               contentType="application/json">
    </core-ajax>


    <div class="top">
      <core-input id="tickerComment"
                  multiline
                  class="input"
                  rows="3"
                  placeholder="Enter comments here.">
      </core-input>
    </div>
    <div class="bottom">
      <paper-button raisedButton
                    class="colored green"
                    label="PASS"
                    on-tap="{{passTick}}">
      </paper-button>
      <paper-button raisedButton
                    class="colored red"
                    label="FAIL"
                    on-tap="{{failTick}}">
      </paper-button>
    </div>
  </template>
  <script src="../../hardcoded.js"></script>
  <script>
    Polymer('ticker-set-result'
      , {   sendTick:
            function (tickStatus, comment)
            {
              "use strict";

              if (typeof comment == typeof undefined)
              {
                comment = null;
              }
              else
              {
                comment = comment.replace(/\n/gm, "\\n")
                                 .replace(/\'/gm, "\\'")
                                 .replace(/\"/gm, '\\"')
                                 .replace(/\&/gm, "\\&")
                                 .replace(/\r/gm, "\\r")
                                 .replace(/\t/gm, "\\t")
                                 .replace(/\b/gm, "\\b")
                                 .replace(/\f/gm, "\\f");
              }

              this.$.setTickResult.url =
                ticking_service + "/fork/"
                  + this.crsid + "/"
                  + this.tickId;

              this.$.setTickResult.body =
                  '{   "humanPass"      : "' + tickStatus + '"'
                + '  , "signedUp"       : false'
                + '  , "tickerComments" : "' + comment + '"'
                + '  , "commitId"       : "' + this.commitId + '"'
                + '}'

              this.$.setTickResult.go();
            }

          , passTick: function ()
            {
              this.sendTick(true,  this.$.tickerComment.value);
            }

          , failTick: function ()
            {
              this.sendTick(false, this.$.tickerComment.value);
            }
        });
  </script>
</polymer-element>
