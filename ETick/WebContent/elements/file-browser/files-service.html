<!-- vim: set shiftwidth=2 tabstop=2 softtabstop=2 expandtab textwidth=72 : -->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<!-- 
  TODO:
  `<files-service>` provides retrieval of files using AJAX.

  Just uses the filesLoaded handler to load the files into the
  `files` attribute.

  @element files-service
  @homepage http://www.github.com/ucam-cl-dtg/urop-2014-ticking-ui
-->

<!--
  An array of file objects, with the following format:

TODO:
  <table border="0">
    <tr>
      <td><code>name</code></td>
      <td>String</td>
      <td>File name with full path.</td>
    </tr>
     <tr>
      <td><code>content</code></td>
      <td>String</td>
        <td>Content of the file, using <LF> for new lines.</td>
    </tr>
    <tr>
      <td><code>comments</code></td>
      <td>Object</td>
      <td>
        Comments using the following format;
        <table border="0">
          <tr>
            <td><code>begin</code></td>
            <td>Number</td>
            <td>Start character, from the beginning of the file
              (counting new lines as a single character).</td>
          </tr>
          <tr>
            <td><code>end</code></td>
            <td>Number</td>
            <td>End character, from the beginning of the file
              (counting new lines as a single character).</td>
          </tr>
          <tr>
            <td><code>line</code></td>
            <td>Number</td>
            <td>File number, instead of `begin` and `end`.</td>
          </tr>
          <tr>
            <td><code>message</code></td>
            <td>String</td>
            <td>Message of the comment.</td>
          </tr>
          <tr>
            <td><code>class</code></td>
            <td>String</td>
            <td>Class to encapsulate comment block in (for styling).</td>
          </tr>
        </table>
      </td>
    </tr>  
  </table>
  
  @attribute files 
  @type Array
  @default []
-->
<polymer-element name="files-service"
    attributes="files testResult tickerResult reportResult comments errors commitID date testCount">
  <template>
    <style>
    :host {
      display: none;
    }
    </style>
    <core-ajax id="ajax"
      auto
      url="test-report.json"
      on-core-response="{{filesLoaded}}"
      handleAs="json">
    </core-ajax>
  </template>
  <script>
  Polymer('files-service'
    , { created: function()
        {
          "use strict";
          this.files = [];
        }
      , filesLoaded: function()
        {
          "use strict";

          /* Make a copy of the loaded data */
          this.files        = this.$.ajax.response.files;
          this.testResult   = this.$.ajax.response.testResult;
          this.tickerResult = this.$.ajax.response.tickerResult;
          this.reportResult = this.$.ajax.response.reportResult;
          this.comments     = this.$.ajax.response.tickerComments;
          this.errors       = this.$.ajax.response.items;
          this.commitID     = this.$.ajax.response.commitId;
          this.date         = this.$.ajax.response.creationDate;
          this.testCount    = this.$.ajax.response.noOfTests;
          this.fire('files-loaded');
        }
      });
  </script>
</polymer-element>
