<!-- vim: set shiftwidth=2 tabstop=2 softtabstop=2 expandtab textwidth=72 : -->
<link rel="import" href="../../bower_components/polymer/polymer.html"/>
<link rel="import" href="../../bower_components/core-splitter/core-splitter.html"/>
<link rel="import" href="../../bower_components/marked-element/marked-element.html"/>
<link rel="import" href="files-service.html"/>
<link rel="import" href="file-card.html"/>
<link rel="import" href="files-list.html"/>
<link rel="import" href="status-list.html"/>
<link rel="import" href="ticker-set-result.html"/>

<!-- This is the main card for file-browsing.
  The mandatory attributes are repoName, tickId.
  The optional attributes are sheetId, crsid, ticker.
  These must be supplied together, if they are supplied.
  If they are supplied, this card also becomes a pass/fail card.
-->
<polymer-element name="file-browser-card"
                 attributes="repoName
                             sheetId
                             tickId
                             crsid
                             ticker">
  <!-- TODO: get ALL reports -->
  <template>
    <link rel="stylesheet" href="style.css"/>
    <link rel="stylesheet" href="file-browser-style.css"/>
    <files-service id="service"
                   date="{{date}}"
                   crsid="{{crsid}}"
                   files="{{files}}"
                   errors="{{errors}}"
                   tickId="{{tickId}}"
                   repoName="{{repoName}}"
                   comments="{{comments}}"
                   commitId="{{commitId}}"
                   testCount="{{testCount}}"
                   testResult="{{testResult}}"
                   tickerResult="{{tickerResult}}"
                   reportResult="{{reportResult}}">
    </files-service>
    <div class="container" horizontal layout>
      <div class="sidebar">
        <p class="result">
          You have {{reportResult=="FAIL" || testResult=="FAIL" ? "failed." : "passed!"}}
        </p>
        <files-list files="{{files}}"
                    selectedFileId="{{selectedFileId}}">
        </files-list>
        <hr/>
        <status-list errors="{{errors}}" highlight="{{highlight}}">
        </status-list>
      </div>
      <core-splitter direction="left"></core-splitter>
      <div class="main">
        <!-- Ticker comments -->
        <template if="{{comments != null}}">
          Ticker comments:
          <!-- Indentation due to marked element considering spaces -->
          <marked-element
              class="ticker-comments">
{{comments}}
          </marked-element>
        </template>

        <select name="syntaxSelect"
                value="{{syntaxStyleSheet}}"
                label="Colour scheme: ">
          <!-- The commented values don't have good highlighting support -->
          <!-- <option value="arta">Arta</option> -->
          <option value="ascetic">Ascetic</option>
          <!-- <option value="atelier-dune.dark">Atelier dune (dark)</option> -->
          <option value="atelier-dune.light">Atelier dune (light)</option>
          <!-- <option value="atelier-forest.dark">Atelier forest (dark)</option> -->
          <option value="atelier-forest.light">Atelier forest (light)</option>
          <!-- <option value="atelier-heath.dark">Atelier heath (dark)</option> -->
          <option value="atelier-heath.light">Atelier heath (light)</option>
          <!-- <option value="atelier-lakeside.dark">Atelier lakeside (dark)</option> -->
          <option value="atelier-lakeside.light">Atelier lakeside (light)</option>
          <!-- <option value="atelier-seaside.dark">Atelier seaside (dark)</option> -->
          <!-- <option value="atelier-seaside.light">Atelier seaside (light)</option> -->
          <option value="brown_paper">Brown paper</option>
          <!-- <option value="dark">Dark</option> -->
          <option value="default" selected="true">Default</option>
          <option value="docco">Docco</option>
          <!-- <option value="far">Far</option> -->
          <option value="foundation">Foundation</option>
          <option value="github">GitHub</option>
          <option value="googlecode">Google code</option>
          <option value="idea">Idea</option>
          <!-- <option value="ir_black">IR black</option> -->
          <option value="magula">Magula</option>
          <option value="mono-blue">Mono blue</option>
          <!-- <option value="monokai">Monokai</option> -->
          <!-- <option value="monokai_sublime">Monokai (Sublime editor)</option> -->
          <!-- <option value="obsidian">Obsidian</option> -->
          <!-- <option value="paraiso.dark">Paraiso (dark)</option> -->
          <option value="paraiso.light">Paraiso (light)</option>
          <!-- <option value="pojoaque">Pojoaque</option> -->
          <!-- <option value="railscasts">Railscasts</option> -->
          <!-- <option value="rainbow">Rainbow</option> -->
          <!-- <option value="school_book">School book</option> -->
          <!-- <option value="solarized_dark">Solarized (dark)</option> -->
          <!-- <option value="solarized_light">Solarized (light)</option> -->
          <!-- <option value="sunburst">Sunburst</option> -->
          <option value="tomorrow">Tomorrow</option>
          <!-- <option value="tomorrow-night-blue">Tomorrow night blue</option> -->
          <!-- <option value="tomorrow-night-bright">Tomorrow night bright</option> -->
          <!-- <option value="tomorrow-night">Tomorrow night</option> -->
          <!-- <option value="tomorrow-night-eighties">Tomorrow night eighties</option> -->
          <option value="vs">VS</option>
          <option value="xcode">XCode</option>
          <!-- <option value="zenburn">Zenburn</option> -->
        </select>

        <!-- File contents -->
        <template repeat="{{file in files}}">
          <section id="file{{file.id}}" name="file{{file.id}}">
          <file-card content="{{file.content}}"
                     name="{{file.name}}"
                     id="{{file.id}}"
                     comments="{{errors}}"
                     highlight="{{highlight}}"
                     syntaxStyleSheet="{{syntaxStyleSheet}}">
          </file-card>
          </section>
        </template>

        <!-- Pass/fail button -->
        <template if="{{ticker != undefined}}">
          <ticker-set-result commitId="{{commitId}}"
                             crsid="{{crsid}}"
                             ticker="{{ticker}}"
                             tickId="{{tickId}}"
                             sheetId="{{sheetId}}"
                             reportCreationDate="{{date}}"
                             on-main-card-swipe-away="{{swipeAway}}"
                             on-tick-passed="{{tickPassed}}"
							 on-tick-failed="{{tickFailed}}" 
							 on-tick-no-show="{{tickNoShow}}">
          </ticker-set-result>
        </template>

      </div>
    </div>

  </template>
  <script>
    Polymer('file-browser-card'
      , {   syntaxStyleSheet: "default"
          , selectedFileIdChanged:
            function ()
            {
              var element = 
                this.shadowRoot
                  .getElementById(this.selectedFileId);
              window.scroll(element.offsetLeft, element.offsetTop);
            }
          , swipeBack:
            function ()
            {
              this.fire("main-card-swipe-back", {"card":this});
            }
  		  , updateTickerView:
  		    function()
  			{
  			  this.fire("main-card-swipe-away", {"card":this});
  			  this.fire("update-ticker-viewer", {"result": this.result});
  			}
  		  , tickPassed:
  		    function()
  			{
  			  this.result = "pass";
  			  this.updateTickerView();
  			}
  		  , tickFailed:
  		    function()
  			{
  			  this.result = "fail";
  			  this.updateTickerView();
  			}
  		  , tickNoShow:
  		    function()
  			{
  			  this.result = "noShow";
  			  this.updateTickerView();
  			}
        });
  </script>
</polymer-element>
