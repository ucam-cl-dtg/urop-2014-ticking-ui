<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../bower_components/core-overlay/core-overlay.html">
<link rel="import" href="user-card.html">
<link rel="import" href="ssh-card.html">
<link rel="import" href="main-card.html">
<link rel="import" href="upcoming-slots.html">

<polymer-element name="user-dash" attributes="">
	<template>
		<style>
			:host {
				display: block;
			}
			
		</style>

		<!-- Logging in API call. -->
		<core-ajax id="loginAjax"
			auto
			url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/user"
			handleAs="json"
			on-core-response="{{loginResponse}}">
		</core-ajax>

		<!-- Upcoming events API call. -->
		<core-ajax id="upcomingAPI"
			auto
			url="http://urop2014.dtg.cl.cam.ac.uk/UROP_UI/api/signups/bookings"
			handleAs="json"
			on-core-response="{{upcomingResponse}}">
		</core-ajax>

		<template if="{{data && !data.ssh}}">
			<main-card animated>
				<ssh-card id="userCard"></ssh-card>
			</main-card>
		</template>
		
		<template if="{{data}}">
			<main-card animated>
				<user-card id="userCard" ldap="{{data}}"></user-card>
			</main-card>
		</template>

		<template if="{{slots}}">
			<main-card animated>
				<upcoming-slots slots="{{slots}}"></upcoming-slots>
			</main-card>
		</template>

	</template>

	<script>
		Polymer('user-dash', {

			loginResponse: function() {
				this.data = this.$.loginAjax.response;
			},

			upcomingResponse: function() {
				this.slots = this.$.upcomingAPI.response;
			}
		});
	</script>
</polymer-element>