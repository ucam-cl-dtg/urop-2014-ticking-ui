<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="search-box.html">
<link rel="import" href="tick-session-box.html">
<link rel="import" href="box-list.html">
<link rel="import" href="add-session.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<polymer-element name="tick-session-list" attributes="gid sheets isAuthor">
	<template>
		<style>
			:host {
				display: block;
				width: 100%;
			}
			h1 {
				font-size: 1.8rem;
				font-weight: 100;
				padding: 0 0 0 10px;
			}
		</style>

		<div id="headerBar" layout horizontal center end-justified>
			<!-- <h1 flex>Ticking Sessions ({{sheets ? sheets.length : 0}})</h1> -->
			<template if="{{isAuthor}}">
				<paper-icon-button id="addSessionButton" icon="add" on-click="{{addClicked}}"></paper-icon-button>
				<paper-icon-button id="editSessionButton" icon="create" on-click="{{editClicked}}"></paper-icon-button>
			</template>
			<search-box id="searchBox" placeholder="Search..."></search-box>
		</div>

		<box-list selector id="list" on-core-select="{{sheetSelected}}">
			<template repeat="{{sheet in sheets | sheetListFilter($.searchBox.query) }}">
				<tick-session-box class="itemBox" sheet="{{sheet}}"></tick-session-box>
			</template>
		</box-list>
	</template>
	<script>
		Polymer('tick-session-list', {
			sheetListFilter: function(items, q) {
				if (items && q) {
					return items.filter(this.sheetFilter.bind(this));
				}
				return items;
			},

			sheetFilter: function(item) {
				var q = this.$.searchBox.query.toLowerCase();
				return (item.title.toLowerCase().indexOf(q) > -1);
			},

			addClicked: function () {
				this.fire('add-sheet-clicked');
			},

			sheetSelected: function () {
				var sel = this.$.list.$.selector.selectedItem;
				if (sel) {
					this.selectedSheet = sel.sheet;
				}

			},

			editClicked: function () {
				if (this.selectedSheet) {
					this.fire('edit-sheet-clicked', {
						sheet: this.selectedSheet
					});
				}
			}
		});
	</script>
</polymer-element>